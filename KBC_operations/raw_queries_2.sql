SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42106' order by name;
DROP TABLE [WORKSPACE_42106].[tableLoaded];
SELECT name FROM sys.views WHERE schema_name(schema_id) = 'WORKSPACE_42106' order by name;
DROP SCHEMA [WORKSPACE_42106];
EXEC sp_droprolemember 'KEBOOLA_ZAJCA_XWORKSPACE_42106_ROLE', 'KEBOOLA_ZAJCA_XWORKSPACE_42106_USER';
DROP ROLE [KEBOOLA_ZAJCA_XWORKSPACE_42106_ROLE];
DROP USER [KEBOOLA_ZAJCA_XWORKSPACE_42106_USER];
DROP LOGIN [KEBOOLA_ZAJCA_XWORKSPACE_42106_USER];
-- HERE WE GO!!!
--
-- START CASE: SPK_NO_PK
--
--
-- OPERATION: Table from CSV
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK] ([id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '17747466' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '17747466';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '17747466' AND c.object_id = '17747466';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d5e272531_03821372] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d5e272531_03821372] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42194-2021-04-07/languages.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:21:02Z&se=2021-04-07T19:21:02Z&sp=rl&sig=Bc7dMzNJD3ClKZRMTnocPav69m0%2F4ofcAV%2BpNASFk3g%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d5e272531_03821372];
BEGIN TRANSACTION;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK] ([id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:21:08' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d5e272531_03821372] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d5e272531_03821372];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK]';
-- OPERATION: Load table to WS
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT name FROM sys.views WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [name] nvarchar(4000)) WITH (DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id],[name]) SELECT [id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[tableLoaded];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '33747523' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '17747466' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '17747466';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '17747466' AND c.object_id = '17747466';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d7c2ffd83_05141835] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d7c2ffd83_05141835] ([id], [name]) SELECT [id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d7c2ffd83_05141835];
BEGIN TRANSACTION;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK] ([id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:21:35' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d7c2ffd83_05141835] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d7c2ffd83_05141835];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK]';
-- OPERATION: Table from CSV inc
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK] ([id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '49747580' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '49747580';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '49747580' AND c.object_id = '49747580';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d872e1b63_44301953] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d872e1b63_44301953] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42201-2021-04-07/languages.increment.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:21:43Z&se=2021-04-07T19:21:43Z&sp=rl&sig=SIeKkcGOJiQefV0wBw5nDQR3s%2Bb2SEaebuuZzvUDFMI%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d872e1b63_44301953];
BEGIN TRANSACTION;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK] ([id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:21:47' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d872e1b63_44301953] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d872e1b63_44301953];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK]';
-- OPERATION: Load table to WS inc
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '33747523' ORDER BY c.column_id ;
CREATE TABLE [WORKSPACE_42193].[__temp_validation606d5d8f5ff8e9_63762642] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[WORKSPACE_42193].[__temp_validation606d5d8f5ff8e9_63762642]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '65747637' ORDER BY c.column_id ;
DROP TABLE [WORKSPACE_42193].[__temp_validation606d5d8f5ff8e9_63762642];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded]', N'U') IS NULL CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [name] nvarchar(4000)) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '33747523' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '33747523';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '33747523' AND c.object_id = '33747523';
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5d90e5f929_65874203] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5d90e5f929_65874203] ([id], [name]) SELECT [id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_NO_PK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[#__temp_csvimport606d5d90e5f929_65874203];
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5d93cabe30_74360030] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
BEGIN TRANSACTION;
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id], [name]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name] FROM [WORKSPACE_42193].[#__temp_csvimport606d5d90e5f929_65874203] AS [src]);
COMMIT;
DROP TABLE [WORKSPACE_42193].[#__temp_csvimport606d5d90e5f929_65874203];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp_rename]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp_rename];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS inc
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '33747523' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '17747466' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '17747466';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '17747466' AND c.object_id = '17747466';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d99896757_53478099] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d99896757_53478099] ([id], [name]) SELECT [id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d99896757_53478099];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d9c2a1b52_86707967] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
BEGIN TRANSACTION;
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK] ([id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:22:04' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d99896757_53478099] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5d99896757_53478099];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_NO_PK]';
-- END CASE: SPK_NO_PK
-- START CASE: SPK_PK
--
--
-- OPERATION: Table from CSV
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK] ([id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2, PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '81747694' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '81747694';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '81747694' AND c.object_id = '81747694';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5da5c021a6_82636091] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5da5c021a6_82636091] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42208-2021-04-07/languages.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:22:13Z&se=2021-04-07T19:22:13Z&sp=rl&sig=KeCrQ32BymGPYID098TwJe%2BDrflvkzvwVwdakn68UlM%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5da5c021a6_82636091];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp] WITH (DISTRIBUTION=HASH([id])) AS SELECT a.[id],a.[name], '2021-04-07 07:22:18' AS [_timestamp] FROM (SELECT COALESCE([id], '') AS [id],COALESCE([name], '') AS [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5da5c021a6_82636091]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK] TO [tableSPK_PK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp] TO [tableSPK_PK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5da5c021a6_82636091];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK]';
-- OPERATION: Load table to WS
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
DROP TABLE [WORKSPACE_42193].[tableLoaded];
SELECT name FROM sys.views WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id],[name]) SELECT [id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[tableLoaded];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '129747865' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '113747808' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '113747808';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '113747808' AND c.object_id = '113747808';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5db5934571_93143239] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5db5934571_93143239] ([id], [name]) SELECT [id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5db5934571_93143239];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp] WITH (DISTRIBUTION=HASH([id])) AS SELECT a.[id],a.[name], '2021-04-07 07:22:31' AS [_timestamp] FROM (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5db5934571_93143239]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK] TO [tableSPK_PK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp] TO [tableSPK_PK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5db5934571_93143239];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK]';
-- OPERATION: Table from CSV inc
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK] ([id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2, PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '177748036' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '177748036';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '177748036' AND c.object_id = '177748036';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dbfdf4802_73067525] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dbfdf4802_73067525] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42215-2021-04-07/languages.increment.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:22:39Z&se=2021-04-07T19:22:39Z&sp=rl&sig=lkWtLkRvpSf01aKQ%2BW5ZVmv5HBREq88W%2F8kG8u5a%2BUQ%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dbfdf4802_73067525];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_tmp] WITH (DISTRIBUTION=HASH([id])) AS SELECT a.[id],a.[name], '2021-04-07 07:22:43' AS [_timestamp] FROM (SELECT COALESCE([id], '') AS [id],COALESCE([name], '') AS [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dbfdf4802_73067525]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK] TO [tableIncSPK_PK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_tmp] TO [tableIncSPK_PK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dbfdf4802_73067525];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK]';
-- OPERATION: Load table to WS inc
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '129747865' ORDER BY c.column_id ;
CREATE TABLE [WORKSPACE_42193].[__temp_validation606d5dc8a507a6_32405062] ([id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
SELECT OBJECT_ID(N'[WORKSPACE_42193].[__temp_validation606d5dc8a507a6_32405062]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '225748207' ORDER BY c.column_id ;
DROP TABLE [WORKSPACE_42193].[__temp_validation606d5dc8a507a6_32405062];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded]', N'U') IS NULL CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '129747865' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '129747865';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '129747865' AND c.object_id = '129747865';
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5dca4ff108_93387063] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5dca4ff108_93387063] ([id], [name]) SELECT [id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[#__temp_csvimport606d5dca4ff108_93387063];
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5dcc4d7c96_96441944] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
BEGIN TRANSACTION;
UPDATE [WORKSPACE_42193].[tableLoaded] SET [name] = COALESCE([src].[name], '') FROM [WORKSPACE_42193].[#__temp_csvimport606d5dca4ff108_93387063] AS [src] WHERE [WORKSPACE_42193].[tableLoaded].[id] = COALESCE([src].[id], '') AND (COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[id] AS varchar(4000)), '') != COALESCE([src].[id], '') OR COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[name] AS varchar(4000)), '') != COALESCE([src].[name], '')) ;
DELETE [WORKSPACE_42193].[#__temp_csvimport606d5dca4ff108_93387063] WHERE EXISTS (SELECT * FROM [WORKSPACE_42193].[tableLoaded] WHERE [WORKSPACE_42193].[tableLoaded].[id] = COALESCE([WORKSPACE_42193].[#__temp_csvimport606d5dca4ff108_93387063].[id], ''));
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5dcc4d7c96_96441944] ([id], [name]) SELECT a.[id],a.[name] FROM (SELECT [id], [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [WORKSPACE_42193].[#__temp_csvimport606d5dca4ff108_93387063]) AS a WHERE a."_row_number_" = 1;
DELETE FROM [WORKSPACE_42193].[#__temp_csvimport606d5dca4ff108_93387063];
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id], [name]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name] FROM [WORKSPACE_42193].[#__temp_csvimport606d5dcc4d7c96_96441944] AS [src]);
COMMIT;
DROP TABLE [WORKSPACE_42193].[#__temp_csvimport606d5dcc4d7c96_96441944];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp_rename]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp_rename];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS inc
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '129747865' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '161747979' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '161747979';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '161747979' AND c.object_id = '161747979';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd4b91ab0_70752924] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd4b91ab0_70752924] ([id], [name]) SELECT [id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd4b91ab0_70752924];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd6c203c4_51865979] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
BEGIN TRANSACTION;
UPDATE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK] SET [name] = COALESCE([src].[name], ''), [_timestamp] = '2021-04-07 07:23:02' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd4b91ab0_70752924] AS [src] WHERE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK].[id] = COALESCE([src].[id], '') AND (COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK].[id] AS varchar(4000)), '') != COALESCE([src].[id], '') OR COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK].[name] AS varchar(4000)), '') != COALESCE([src].[name], '')) ;
DELETE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd4b91ab0_70752924] WHERE EXISTS (SELECT * FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK] WHERE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK].[id] = COALESCE([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd4b91ab0_70752924].[id], ''));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd6c203c4_51865979] ([id], [name]) SELECT a.[id],a.[name] FROM (SELECT [id], [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd4b91ab0_70752924]) AS a WHERE a."_row_number_" = 1;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd4b91ab0_70752924];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK] ([id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:23:02' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd6c203c4_51865979] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dd6c203c4_51865979];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK]';
-- END CASE: SPK_PK
-- START CASE: SPK_PK_DK
--
--
-- OPERATION: Table from CSV
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK] ([id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2, PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([name]));
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '257748321' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '257748321';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '257748321' AND c.object_id = '257748321';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5de1475cb1_71114112] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([name]));
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5de1475cb1_71114112] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42222-2021-04-07/languages.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:23:13Z&se=2021-04-07T19:23:13Z&sp=rl&sig=tpKLqVBq%2BU6xgngE4fTMYpDuae1n0UWcl2FKUmfmEJI%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5de1475cb1_71114112];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp] WITH (DISTRIBUTION=HASH([name])) AS SELECT a.[id],a.[name], '2021-04-07 07:23:16' AS [_timestamp] FROM (SELECT COALESCE([id], '') AS [id],COALESCE([name], '') AS [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5de1475cb1_71114112]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK] TO [tableSPK_PK_DK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp] TO [tableSPK_PK_DK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5de1475cb1_71114112];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK]';
-- OPERATION: Load table to WS
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
DROP TABLE [WORKSPACE_42193].[tableLoaded];
SELECT name FROM sys.views WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([name]));
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id],[name]) SELECT [id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[tableLoaded];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '305748492' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '289748435' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '289748435';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '289748435' AND c.object_id = '289748435';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5df26d24d9_75600877] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([name]));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5df26d24d9_75600877] ([id], [name]) SELECT [id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5df26d24d9_75600877];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp] WITH (DISTRIBUTION=HASH([name])) AS SELECT a.[id],a.[name], '2021-04-07 07:23:32' AS [_timestamp] FROM (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5df26d24d9_75600877]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK] TO [tableSPK_PK_DK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp] TO [tableSPK_PK_DK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5df26d24d9_75600877];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK]';
-- OPERATION: Table from CSV inc
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK] ([id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2, PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([name]));
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '353748663' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '353748663';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '353748663' AND c.object_id = '353748663';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dfd4b1135_83822947] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([name]));
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dfd4b1135_83822947] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42229-2021-04-07/languages.increment.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:23:41Z&se=2021-04-07T19:23:41Z&sp=rl&sig=DV9lkEQaS9eIoFkY3%2BZosqrrr%2BT60ZQeAHQSBN5L2VI%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dfd4b1135_83822947];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK_tmp] WITH (DISTRIBUTION=HASH([name])) AS SELECT a.[id],a.[name], '2021-04-07 07:23:46' AS [_timestamp] FROM (SELECT COALESCE([id], '') AS [id],COALESCE([name], '') AS [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dfd4b1135_83822947]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK] TO [tableIncSPK_PK_DK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK_tmp] TO [tableIncSPK_PK_DK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5dfd4b1135_83822947];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK]';
-- OPERATION: Load table to WS inc
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '305748492' ORDER BY c.column_id ;
CREATE TABLE [WORKSPACE_42193].[__temp_validation606d5e09f22c95_53774148] ([id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([name]));
SELECT OBJECT_ID(N'[WORKSPACE_42193].[__temp_validation606d5e09f22c95_53774148]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '401748834' ORDER BY c.column_id ;
DROP TABLE [WORKSPACE_42193].[__temp_validation606d5e09f22c95_53774148];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded]', N'U') IS NULL CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([name]));
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '305748492' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '305748492';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '305748492' AND c.object_id = '305748492';
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5e0bcaa879_94604888] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([name]));
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5e0bcaa879_94604888] ([id], [name]) SELECT [id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncSPK_PK_DK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[#__temp_csvimport606d5e0bcaa879_94604888];
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5e0deb9704_05068820] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([name]));
BEGIN TRANSACTION;
UPDATE [WORKSPACE_42193].[tableLoaded] SET [name] = COALESCE([src].[name], '') FROM [WORKSPACE_42193].[#__temp_csvimport606d5e0bcaa879_94604888] AS [src] WHERE [WORKSPACE_42193].[tableLoaded].[id] = COALESCE([src].[id], '') AND (COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[id] AS varchar(4000)), '') != COALESCE([src].[id], '') OR COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[name] AS varchar(4000)), '') != COALESCE([src].[name], '')) ;
DELETE [WORKSPACE_42193].[#__temp_csvimport606d5e0bcaa879_94604888] WHERE EXISTS (SELECT * FROM [WORKSPACE_42193].[tableLoaded] WHERE [WORKSPACE_42193].[tableLoaded].[id] = COALESCE([WORKSPACE_42193].[#__temp_csvimport606d5e0bcaa879_94604888].[id], ''));
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5e0deb9704_05068820] ([id], [name]) SELECT a.[id],a.[name] FROM (SELECT [id], [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [WORKSPACE_42193].[#__temp_csvimport606d5e0bcaa879_94604888]) AS a WHERE a."_row_number_" = 1;
DELETE FROM [WORKSPACE_42193].[#__temp_csvimport606d5e0bcaa879_94604888];
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id], [name]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name] FROM [WORKSPACE_42193].[#__temp_csvimport606d5e0deb9704_05068820] AS [src]);
COMMIT;
DROP TABLE [WORKSPACE_42193].[#__temp_csvimport606d5e0deb9704_05068820];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp_rename]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp_rename];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS inc
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '305748492' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '337748606' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '337748606';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '337748606' AND c.object_id = '337748606';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1b4d9129_04804055] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([name]));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1b4d9129_04804055] ([id], [name]) SELECT [id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1b4d9129_04804055];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1d83be66_72485466] ([id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([name]));
BEGIN TRANSACTION;
UPDATE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK] SET [name] = COALESCE([src].[name], ''), [_timestamp] = '2021-04-07 07:24:13' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1b4d9129_04804055] AS [src] WHERE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK].[id] = COALESCE([src].[id], '') AND (COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK].[id] AS varchar(4000)), '') != COALESCE([src].[id], '') OR COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK].[name] AS varchar(4000)), '') != COALESCE([src].[name], '')) ;
DELETE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1b4d9129_04804055] WHERE EXISTS (SELECT * FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK] WHERE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK].[id] = COALESCE([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1b4d9129_04804055].[id], ''));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1d83be66_72485466] ([id], [name]) SELECT a.[id],a.[name] FROM (SELECT [id], [name], ROW_NUMBER() OVER (PARTITION BY [id] ORDER BY [id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1b4d9129_04804055]) AS a WHERE a."_row_number_" = 1;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1b4d9129_04804055];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK] ([id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:24:13' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1d83be66_72485466] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e1d83be66_72485466];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableSPK_PK_DK]';
-- END CASE: SPK_PK_DK
-- START CASE: MPK_NO_PK
--
--
-- OPERATION: Table from CSV
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK] ([id] NVARCHAR(4000) NOT NULL, [sub_id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '433748948' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '433748948';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '433748948' AND c.object_id = '433748948';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e3200c6f4_47129629] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e3200c6f4_47129629] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42236-2021-04-07/pk.multiple.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:24:33Z&se=2021-04-07T19:24:33Z&sp=rl&sig=54dUiTYlJr63RSYaq42A5CfWuUW%2F8qvtSethb5y3IQs%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e3200c6f4_47129629];
BEGIN TRANSACTION;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK] ([id], [sub_id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:24:38' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e3200c6f4_47129629] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e3200c6f4_47129629];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK]';
-- OPERATION: Load table to WS
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
DROP TABLE [WORKSPACE_42193].[tableLoaded];
SELECT name FROM sys.views WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id],[sub_id],[name]) SELECT [id], [sub_id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[tableLoaded];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '449749005' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '433748948' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '433748948';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '433748948' AND c.object_id = '433748948';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4109cd79_46570087] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4109cd79_46570087] ([id], [sub_id], [name]) SELECT [id], [sub_id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4109cd79_46570087];
BEGIN TRANSACTION;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK] ([id], [sub_id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:24:52' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4109cd79_46570087] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4109cd79_46570087];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK]';
-- OPERATION: Table from CSV inc
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK] ([id] NVARCHAR(4000) NOT NULL, [sub_id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '465749062' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '465749062';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '465749062' AND c.object_id = '465749062';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4ba1afe5_13249388] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4ba1afe5_13249388] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42243-2021-04-07/pk.multiple.increment.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:24:59Z&se=2021-04-07T19:24:59Z&sp=rl&sig=t006BW52fYkKCHtcsolgkUk2hlwT4WC4VIEGFGwRp7M%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4ba1afe5_13249388];
BEGIN TRANSACTION;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK] ([id], [sub_id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:25:04' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4ba1afe5_13249388] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e4ba1afe5_13249388];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK]';
-- OPERATION: Load table to WS inc
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '449749005' ORDER BY c.column_id ;
CREATE TABLE [WORKSPACE_42193].[__temp_validation606d5e55889ec0_49350602] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[WORKSPACE_42193].[__temp_validation606d5e55889ec0_49350602]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '481749119' ORDER BY c.column_id ;
DROP TABLE [WORKSPACE_42193].[__temp_validation606d5e55889ec0_49350602];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded]', N'U') IS NULL CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '449749005' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '449749005';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '449749005' AND c.object_id = '449749005';
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5e582e5759_91385750] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5e582e5759_91385750] ([id], [sub_id], [name]) SELECT [id], [sub_id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_NO_PK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[#__temp_csvimport606d5e582e5759_91385750];
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5e5b638995_36184482] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
BEGIN TRANSACTION;
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id], [sub_id], [name]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name] FROM [WORKSPACE_42193].[#__temp_csvimport606d5e582e5759_91385750] AS [src]);
COMMIT;
DROP TABLE [WORKSPACE_42193].[#__temp_csvimport606d5e582e5759_91385750];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp_rename]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp_rename];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS inc
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '449749005' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '433748948' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '433748948';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '433748948' AND c.object_id = '433748948';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e61010756_41826382] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e61010756_41826382] ([id], [sub_id], [name]) SELECT [id], [sub_id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e61010756_41826382];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e63d18f28_63912687] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
BEGIN TRANSACTION;
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK] ([id], [sub_id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:25:23' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e61010756_41826382] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e61010756_41826382];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_NO_PK]';
-- END CASE: MPK_NO_PK
-- START CASE: MPK_PK
--
--
-- OPERATION: Table from CSV
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK] ([id] NVARCHAR(4000) NOT NULL, [sub_id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2, PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '497749176' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '497749176';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '497749176' AND c.object_id = '497749176';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e6d84d8d3_04326762] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e6d84d8d3_04326762] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42250-2021-04-07/pk.multiple.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:25:33Z&se=2021-04-07T19:25:33Z&sp=rl&sig=XIIZQl7X%2B7x%2B%2F41kssQlUPm1%2Fg7fSYF0AiZPA0adKdA%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e6d84d8d3_04326762];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp] WITH (DISTRIBUTION=ROUND_ROBIN) AS SELECT a.[id],a.[sub_id],a.[name], '2021-04-07 07:25:37' AS [_timestamp] FROM (SELECT COALESCE([id], '') AS [id],COALESCE([sub_id], '') AS [sub_id],COALESCE([name], '') AS [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e6d84d8d3_04326762]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK] TO [tableMPK_PK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp] TO [tableMPK_PK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e6d84d8d3_04326762];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK]';
-- OPERATION: Load table to WS
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
DROP TABLE [WORKSPACE_42193].[tableLoaded];
SELECT name FROM sys.views WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id],[sub_id],[name]) SELECT [id], [sub_id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[tableLoaded];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '545749347' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '529749290' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '529749290';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '529749290' AND c.object_id = '529749290';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e7fbf2f03_10491968] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e7fbf2f03_10491968] ([id], [sub_id], [name]) SELECT [id], [sub_id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e7fbf2f03_10491968];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp] WITH (DISTRIBUTION=ROUND_ROBIN) AS SELECT a.[id],a.[sub_id],a.[name], '2021-04-07 07:25:54' AS [_timestamp] FROM (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e7fbf2f03_10491968]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK] TO [tableMPK_PK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp] TO [tableMPK_PK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e7fbf2f03_10491968];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK]';
-- OPERATION: Table from CSV inc
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK] ([id] NVARCHAR(4000) NOT NULL, [sub_id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2, PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '593749518' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '593749518';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '593749518' AND c.object_id = '593749518';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e8e509a33_13687326] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e8e509a33_13687326] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42257-2021-04-07/pk.multiple.increment.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:26:06Z&se=2021-04-07T19:26:06Z&sp=rl&sig=ivUer5I95vn9V1ioiySUOJfy4wq8lRHnf3bM%2BkHvshU%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e8e509a33_13687326];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_tmp] WITH (DISTRIBUTION=ROUND_ROBIN) AS SELECT a.[id],a.[sub_id],a.[name], '2021-04-07 07:26:10' AS [_timestamp] FROM (SELECT COALESCE([id], '') AS [id],COALESCE([sub_id], '') AS [sub_id],COALESCE([name], '') AS [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e8e509a33_13687326]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK] TO [tableIncMPK_PK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_tmp] TO [tableIncMPK_PK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5e8e509a33_13687326];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK]';
-- OPERATION: Load table to WS inc
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '545749347' ORDER BY c.column_id ;
CREATE TABLE [WORKSPACE_42193].[__temp_validation606d5e99e6c249_22622441] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[WORKSPACE_42193].[__temp_validation606d5e99e6c249_22622441]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '641749689' ORDER BY c.column_id ;
DROP TABLE [WORKSPACE_42193].[__temp_validation606d5e99e6c249_22622441];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded]', N'U') IS NULL CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=ROUND_ROBIN);
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '545749347' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '545749347';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '545749347' AND c.object_id = '545749347';
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5e9c205cd5_68925374] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5e9c205cd5_68925374] ([id], [sub_id], [name]) SELECT [id], [sub_id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[#__temp_csvimport606d5e9c205cd5_68925374];
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5e9f7a48d3_33408003] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
BEGIN TRANSACTION;
UPDATE [WORKSPACE_42193].[tableLoaded] SET [name] = COALESCE([src].[name], '') FROM [WORKSPACE_42193].[#__temp_csvimport606d5e9c205cd5_68925374] AS [src] WHERE [WORKSPACE_42193].[tableLoaded].[id] = COALESCE([src].[id], '') AND [WORKSPACE_42193].[tableLoaded].[sub_id] = COALESCE([src].[sub_id], '') AND (COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[id] AS varchar(4000)), '') != COALESCE([src].[id], '') OR COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[sub_id] AS varchar(4000)), '') != COALESCE([src].[sub_id], '') OR COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[name] AS varchar(4000)), '') != COALESCE([src].[name], '')) ;
DELETE [WORKSPACE_42193].[#__temp_csvimport606d5e9c205cd5_68925374] WHERE EXISTS (SELECT * FROM [WORKSPACE_42193].[tableLoaded] WHERE [WORKSPACE_42193].[tableLoaded].[id] = COALESCE([WORKSPACE_42193].[#__temp_csvimport606d5e9c205cd5_68925374].[id], '') AND [WORKSPACE_42193].[tableLoaded].[sub_id] = COALESCE([WORKSPACE_42193].[#__temp_csvimport606d5e9c205cd5_68925374].[sub_id], ''));
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5e9f7a48d3_33408003] ([id], [sub_id], [name]) SELECT a.[id],a.[sub_id],a.[name] FROM (SELECT [id], [sub_id], [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [WORKSPACE_42193].[#__temp_csvimport606d5e9c205cd5_68925374]) AS a WHERE a."_row_number_" = 1;
DELETE FROM [WORKSPACE_42193].[#__temp_csvimport606d5e9c205cd5_68925374];
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id], [sub_id], [name]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name] FROM [WORKSPACE_42193].[#__temp_csvimport606d5e9f7a48d3_33408003] AS [src]);
COMMIT;
DROP TABLE [WORKSPACE_42193].[#__temp_csvimport606d5e9f7a48d3_33408003];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp_rename]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp_rename];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS inc
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '545749347' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '577749461' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '577749461';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '577749461' AND c.object_id = '577749461';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ea8bb3903_01245981] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ea8bb3903_01245981] ([id], [sub_id], [name]) SELECT [id], [sub_id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ea8bb3903_01245981];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eaba42b61_29875945] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=ROUND_ROBIN);
BEGIN TRANSACTION;
UPDATE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK] SET [name] = COALESCE([src].[name], ''), [_timestamp] = '2021-04-07 07:26:35' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ea8bb3903_01245981] AS [src] WHERE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK].[id] = COALESCE([src].[id], '') AND [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK].[sub_id] = COALESCE([src].[sub_id], '') AND (COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK].[id] AS varchar(4000)), '') != COALESCE([src].[id], '') OR COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK].[sub_id] AS varchar(4000)), '') != COALESCE([src].[sub_id], '') OR COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK].[name] AS varchar(4000)), '') != COALESCE([src].[name], '')) ;
DELETE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ea8bb3903_01245981] WHERE EXISTS (SELECT * FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK] WHERE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK].[id] = COALESCE([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ea8bb3903_01245981].[id], '') AND [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK].[sub_id] = COALESCE([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ea8bb3903_01245981].[sub_id], ''));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eaba42b61_29875945] ([id], [sub_id], [name]) SELECT a.[id],a.[sub_id],a.[name] FROM (SELECT [id], [sub_id], [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ea8bb3903_01245981]) AS a WHERE a."_row_number_" = 1;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ea8bb3903_01245981];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK] ([id], [sub_id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:26:35' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eaba42b61_29875945] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eaba42b61_29875945];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK]';
-- END CASE: MPK_PK
-- START CASE: MPK_PK_DK
--
--
-- OPERATION: Table from CSV
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK] ([id] NVARCHAR(4000) NOT NULL, [sub_id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2, PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '673749803' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '673749803';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '673749803' AND c.object_id = '673749803';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eb96d9944_78973562] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eb96d9944_78973562] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42264-2021-04-07/pk.multiple.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:26:49Z&se=2021-04-07T19:26:49Z&sp=rl&sig=ibePg4%2FToe%2F9n9kaeJpMduHhDAGlsbQ24eMAWeTcTdU%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eb96d9944_78973562];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp] WITH (DISTRIBUTION=HASH([id])) AS SELECT a.[id],a.[sub_id],a.[name], '2021-04-07 07:26:53' AS [_timestamp] FROM (SELECT COALESCE([id], '') AS [id],COALESCE([sub_id], '') AS [sub_id],COALESCE([name], '') AS [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eb96d9944_78973562]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK] TO [tableMPK_PK_DK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp] TO [tableMPK_PK_DK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eb96d9944_78973562];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK]';
-- OPERATION: Load table to WS
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
DROP TABLE [WORKSPACE_42193].[tableLoaded];
SELECT name FROM sys.views WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id],[sub_id],[name]) SELECT [id], [sub_id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[tableLoaded];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '721749974' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '705749917' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '705749917';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '705749917' AND c.object_id = '705749917';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eca0e2496_40272577] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eca0e2496_40272577] ([id], [sub_id], [name]) SELECT [id], [sub_id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eca0e2496_40272577];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp] WITH (DISTRIBUTION=HASH([id])) AS SELECT a.[id],a.[sub_id],a.[name], '2021-04-07 07:27:08' AS [_timestamp] FROM (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eca0e2496_40272577]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK] TO [tableMPK_PK_DK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp] TO [tableMPK_PK_DK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eca0e2496_40272577];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK]';
-- OPERATION: Table from CSV inc
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK] ([id] NVARCHAR(4000) NOT NULL, [sub_id] NVARCHAR(4000) NOT NULL, [name] NVARCHAR(4000) NOT NULL, [_timestamp] DATETIME2, PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '769750145' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '769750145';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '769750145' AND c.object_id = '769750145';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ed5250887_82206270] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
COPY INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ed5250887_82206270] FROM 'https://kbcfsznsajl4ssv6zw.blob.core.windows.net/exp-15-files-384-42271-2021-04-07/pk.multiple.increment.csv.gz' WITH (     FILE_TYPE='CSV',     CREDENTIAL=(IDENTITY='Shared Access Signature', SECRET='?sv=2017-11-09&sr=c&st=2021-04-07T07:27:17Z&se=2021-04-07T19:27:17Z&sp=rl&sig=GNzWbxvCTmhl88J2Cid58jHv5xFb5brreqpdBZyH0OI%3D'),     FIELDQUOTE='"',     FIELDTERMINATOR=',',     ENCODING = 'UTF8',     ROWTERMINATOR='0x0A',     IDENTITY_INSERT = 'OFF'     ,FIRSTROW=2 );
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ed5250887_82206270];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK_tmp] WITH (DISTRIBUTION=HASH([id])) AS SELECT a.[id],a.[sub_id],a.[name], '2021-04-07 07:27:21' AS [_timestamp] FROM (SELECT COALESCE([id], '') AS [id],COALESCE([sub_id], '') AS [sub_id],COALESCE([name], '') AS [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ed5250887_82206270]) AS a WHERE a."_row_number_" = 1;
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK] TO [tableIncMPK_PK_DK_tmp_rename];
RENAME OBJECT [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK_tmp] TO [tableIncMPK_PK_DK];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK_tmp_rename];
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ed5250887_82206270];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK]';
-- OPERATION: Load table to WS inc
SELECT name FROM sys.tables WHERE schema_name(schema_id) = 'WORKSPACE_42193' order by name;
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '721749974' ORDER BY c.column_id ;
CREATE TABLE [WORKSPACE_42193].[__temp_validation606d5edfa59605_99267057] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
SELECT OBJECT_ID(N'[WORKSPACE_42193].[__temp_validation606d5edfa59605_99267057]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '817750316' ORDER BY c.column_id ;
DROP TABLE [WORKSPACE_42193].[__temp_validation606d5edfa59605_99267057];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded]', N'U') IS NULL CREATE TABLE [WORKSPACE_42193].[tableLoaded]([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000), PRIMARY KEY NONCLUSTERED([id],[sub_id]) NOT ENFORCED) WITH (DISTRIBUTION=HASH([id]));
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '721749974' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '721749974';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '721749974' AND c.object_id = '721749974';
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5ee3ccbc72_75654186] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5ee3ccbc72_75654186] ([id], [sub_id], [name]) SELECT [id], [sub_id], [name] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableIncMPK_PK_DK];
SELECT COUNT(*) AS [count] FROM [WORKSPACE_42193].[#__temp_csvimport606d5ee3ccbc72_75654186];
CREATE TABLE [WORKSPACE_42193].[#__temp_csvimport606d5ee65abc71_38736675] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
BEGIN TRANSACTION;
UPDATE [WORKSPACE_42193].[tableLoaded] SET [name] = COALESCE([src].[name], '') FROM [WORKSPACE_42193].[#__temp_csvimport606d5ee3ccbc72_75654186] AS [src] WHERE [WORKSPACE_42193].[tableLoaded].[id] = COALESCE([src].[id], '') AND [WORKSPACE_42193].[tableLoaded].[sub_id] = COALESCE([src].[sub_id], '') AND (COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[id] AS varchar(4000)), '') != COALESCE([src].[id], '') OR COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[sub_id] AS varchar(4000)), '') != COALESCE([src].[sub_id], '') OR COALESCE(CAST([WORKSPACE_42193].[tableLoaded].[name] AS varchar(4000)), '') != COALESCE([src].[name], '')) ;
DELETE [WORKSPACE_42193].[#__temp_csvimport606d5ee3ccbc72_75654186] WHERE EXISTS (SELECT * FROM [WORKSPACE_42193].[tableLoaded] WHERE [WORKSPACE_42193].[tableLoaded].[id] = COALESCE([WORKSPACE_42193].[#__temp_csvimport606d5ee3ccbc72_75654186].[id], '') AND [WORKSPACE_42193].[tableLoaded].[sub_id] = COALESCE([WORKSPACE_42193].[#__temp_csvimport606d5ee3ccbc72_75654186].[sub_id], ''));
INSERT INTO [WORKSPACE_42193].[#__temp_csvimport606d5ee65abc71_38736675] ([id], [sub_id], [name]) SELECT a.[id],a.[sub_id],a.[name] FROM (SELECT [id], [sub_id], [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [WORKSPACE_42193].[#__temp_csvimport606d5ee3ccbc72_75654186]) AS a WHERE a."_row_number_" = 1;
DELETE FROM [WORKSPACE_42193].[#__temp_csvimport606d5ee3ccbc72_75654186];
INSERT INTO [WORKSPACE_42193].[tableLoaded] ([id], [sub_id], [name]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name] FROM [WORKSPACE_42193].[#__temp_csvimport606d5ee65abc71_38736675] AS [src]);
COMMIT;
DROP TABLE [WORKSPACE_42193].[#__temp_csvimport606d5ee65abc71_38736675];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp];
IF OBJECT_ID (N'[WORKSPACE_42193].[tableLoaded_tmp_rename]', N'U') IS NOT NULL DROP TABLE [WORKSPACE_42193].[tableLoaded_tmp_rename];
EXEC sp_spaceused '[WORKSPACE_42193].[tableLoaded]';
-- OPERATION: Load table from WS inc
SELECT OBJECT_ID(N'[WORKSPACE_42193].[tableLoaded]');
SELECT     c.name AS column_name,     c.precision AS column_precision,     c.scale AS column_scale,     c.max_length AS column_length,     c.is_nullable AS column_is_nullable,     d.definition AS column_default,     t.name AS column_type FROM sys.columns AS c JOIN sys.types AS t ON t.user_type_id = c.user_type_id LEFT JOIN sys.default_constraints AS d ON c.default_object_id = d.object_id WHERE c.object_id = '721749974' ORDER BY c.column_id ;
SELECT OBJECT_ID(N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK]');
SELECT [name] FROM [sys].[columns] WHERE [object_id] = '753750088' ORDER BY [column_id];
SELECT distribution_policy_desc     FROM sys.pdw_table_distribution_properties AS dp     WHERE dp.OBJECT_ID = '753750088';
SELECT c.name FROM sys.pdw_column_distribution_properties AS dp      INNER JOIN sys.columns AS c ON dp.column_id = c.column_id WHERE dp.distribution_ordinal = 1 AND dp.OBJECT_ID = '753750088' AND c.object_id = '753750088';
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eef795e23_28566631] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eef795e23_28566631] ([id], [sub_id], [name]) SELECT [id], [sub_id], [name] FROM [WORKSPACE_42193].[tableLoaded];
SELECT COUNT(*) AS [count] FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eef795e23_28566631];
CREATE TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ef20885d9_66526392] ([id] nvarchar(4000), [sub_id] nvarchar(4000), [name] nvarchar(4000)) WITH (HEAP, LOCATION = USER_DB, DISTRIBUTION=HASH([id]));
BEGIN TRANSACTION;
UPDATE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK] SET [name] = COALESCE([src].[name], ''), [_timestamp] = '2021-04-07 07:27:46' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eef795e23_28566631] AS [src] WHERE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK].[id] = COALESCE([src].[id], '') AND [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK].[sub_id] = COALESCE([src].[sub_id], '') AND (COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK].[id] AS varchar(4000)), '') != COALESCE([src].[id], '') OR COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK].[sub_id] AS varchar(4000)), '') != COALESCE([src].[sub_id], '') OR COALESCE(CAST([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK].[name] AS varchar(4000)), '') != COALESCE([src].[name], '')) ;
DELETE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eef795e23_28566631] WHERE EXISTS (SELECT * FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK] WHERE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK].[id] = COALESCE([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eef795e23_28566631].[id], '') AND [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK].[sub_id] = COALESCE([KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eef795e23_28566631].[sub_id], ''));
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ef20885d9_66526392] ([id], [sub_id], [name]) SELECT a.[id],a.[sub_id],a.[name] FROM (SELECT [id], [sub_id], [name], ROW_NUMBER() OVER (PARTITION BY [id],[sub_id] ORDER BY [id],[sub_id]) AS "_row_number_" FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eef795e23_28566631]) AS a WHERE a."_row_number_" = 1;
DELETE FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5eef795e23_28566631];
INSERT INTO [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK] ([id], [sub_id], [name], [_timestamp]) (SELECT CAST(COALESCE([id], '') as nvarchar(4000)) AS [id],CAST(COALESCE([sub_id], '') as nvarchar(4000)) AS [sub_id],CAST(COALESCE([name], '') as nvarchar(4000)) AS [name],'2021-04-07 07:27:46' FROM [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ef20885d9_66526392] AS [src]);
COMMIT;
DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[#__temp_csvimport606d5ef20885d9_66526392];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp];
IF OBJECT_ID (N'[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp_rename]', N'U') IS NOT NULL DROP TABLE [KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK_tmp_rename];
EXEC sp_spaceused '[KEBOOLA_ZAJCA_X384-in_c-API-tests-9c0ef4e0850f1b365af1c3655957cb98c8d73590].[tableMPK_PK_DK]';
-- END CASE: MPK_PK_DK